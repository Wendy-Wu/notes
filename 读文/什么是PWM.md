### 什么是PWM？
PWM（脉宽调制，Pulse Width Modulation）是一种通过调节信号的**占空比**来实现模拟信号控制的数字方法。它的基本原理是生成一个固定频率的方波信号，通过改变该信号的高电平和低电平时间的比例（即占空比），从而控制设备的平均功率输出。PWM广泛应用于控制LED亮度、电机速度、加热元件等。

### PWM如何控制LED亮度？
LED的亮度与电流的大小成正比。使用PWM控制LED亮度时，实际上是通过改变LED每个周期内“亮”的时间占比来调节LED的“平均电流”，从而实现亮度的调节。具体地，PWM信号的占空比越高，LED在一个周期内保持亮的时间越长，亮度也越高；占空比越低，LED亮的时间越短，亮度越暗。

**为什么PWM控制亮度渐变？**

- **PWM的高电平时间（ON时间）和低电平时间（OFF时间）控制了LED亮灭的时长**。在一个PWM周期内，LED会在高电平和低电平之间快速切换。由于LED的响应时间相对较短，肉眼无法分辨这些快速切换，LED表现为平均亮度的渐变效果。
  
- **占空比越高，LED在一个周期内亮的时间就越长**，平均电流就越大，LED亮度就越高；占空比越低，LED的亮度越低。

- **PWM信号的频率**：PWM信号的频率（例如，1 kHz）决定了LED变化的平滑程度。较高的频率可以使LED的亮度变化更加平滑，不会出现闪烁。

### Verilog代码实现PWM

下面是一个Verilog实现PWM的简单例子，适用于控制LED的亮度：

```verilog
module pwm_generator (
    input clk,            // 输入时钟信号
    input [7:0] duty,     // 8位的占空比控制信号
    output pwm_out        // PWM输出信号
);
    reg [7:0] counter;    // 8位计数器
    reg pwm_signal;       // PWM信号

    // 每个时钟周期计数器加1
    always @(posedge clk) begin
        counter <= counter + 1;  // 计数器递增
    end

    // 产生PWM信号
    always @(posedge clk) begin
        if (counter < duty) begin
            pwm_signal <= 1;  // 当计数器小于占空比时，输出高电平
        end else begin
            pwm_signal <= 0;  // 否则，输出低电平
        end
    end

    assign pwm_out = pwm_signal; // 输出PWM信号
endmodule
```

### 解释：
1. **输入 `clk`**：时钟信号，用于驱动计数器递增。通常，时钟频率越高，PWM信号的频率就越高。
2. **输入 `duty`**：占空比控制信号，通常为8位数字，取值范围是0到255。`duty`决定了PWM信号高电平持续的时间占整个周期的比例，从而控制LED的亮度。
3. **计数器 `counter`**：计数器从0到255递增，当它的值小于占空比（`duty`）时，输出高电平，表示LED处于亮的状态；否则输出低电平，表示LED处于灭的状态。
4. **PWM信号 `pwm_signal`**：根据计数器的值和占空比，产生对应的PWM波形。`counter`小于`duty`时，`pwm_signal`为1（高电平）；否则为0（低电平）。
5. **`pwm_out` 输出**：该信号将作为PWM输出控制LED的亮度。

### 为什么PWM能实现LED亮度渐变？
- **LED的电流控制**：LED的亮度是通过电流控制的。通过PWM的高电平持续时间（ON时间）来控制LED实际接收到的电流。PWM信号的占空比越高，LED的亮度就越高，反之则越暗。
  
- **人眼的视觉效应**：由于PWM频率通常设定为较高（例如1kHz以上），人眼无法分辨出高频开关的变化，所以LED看起来是连续发光的。LED的亮度渐变是通过调整占空比来实现的。

### 占空比与LED亮度的关系：
- 当占空比为0（`duty = 0`），PWM信号永远为低电平，LED始终熄灭。
- 当占空比为50%（`duty = 128`），PWM信号有一半时间为高电平，另一半时间为低电平，LED将处于半亮状态。
- 当占空比为100%（`duty = 255`），PWM信号始终为高电平，LED将始终保持最大亮度。

### 总结：
通过改变PWM信号的占空比（即高电平时间和低电平时间的比例），可以控制LED的平均电流，从而实现LED亮度的调节。PWM本质上是通过数字信号来模拟模拟信号的变化，利用人眼对快速切换的响应，产生平滑的亮度变化效果。